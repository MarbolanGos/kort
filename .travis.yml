language: php

php: 5.3

env: 
  matrix:
  - DEPLOY="false" TARGET_ENV="dev" CI_HOME=`pwd`/odi86/kort
  - DEPLOY="false" TARGET_ENV="prod" CI_HOME=`pwd`/odi86/kort
  global:
    -secure: "EIn+Rm7OxX8OKygBRBCaSTOqFGcBMWu5kHdKqSxOmHRJYjxuMOJpKV+rnyep\n+RsyFDx2Z9yKlqRRS4cpZh7M6wwC63EV46+7aWtzzTjnbMZfVzLQA9EmaEU4\nYMsKGtpQk2mhvaNKd3UbEpDl0Zq74NnAY0zipx0l02UymcFnZEc="

matrix:
  include:
    - php: 5.4
      env:
        - DEPLOY="true"
        - TARGET_ENV="prod"
        - BUILD_DIR=`pwd`/build_heroku 
        - CI_HOME=`pwd`/odi86/kort
        - secure: "cOmMBP4UyklRC0nfeTZsX/NV4GhMBT+AntUmlWxXS5Rj2yrNcmNc7320gNm5\nCLSVRYyk7/8feyUEMznWrUn/62htZp0tEBAWtXg86dgIZgH4HPy9l2pKuSsH\nxZTHgjUJI7JOuyLG4ID9D5maVLE35UWag/NEtcRVy5QXLZOrs0M="
    - php: 5.4
      env:
        - DEPLOY="true"
        - TARGET_ENV="dev"
        - BUILD_DIR=`pwd`/build_heroku 
        - CI_HOME=`pwd`/odi86/kort
        - secure: "cOmMBP4UyklRC0nfeTZsX/NV4GhMBT+AntUmlWxXS5Rj2yrNcmNc7320gNm5\nCLSVRYyk7/8feyUEMznWrUn/62htZp0tEBAWtXg86dgIZgH4HPy9l2pKuSsH\nxZTHgjUJI7JOuyLG4ID9D5maVLE35UWag/NEtcRVy5QXLZOrs0M="

before_script:
  - gem install sass
  - gem install compass
  - wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh >/dev/null 2>&1
  - sudo npm install -g grunt >/dev/null 2>&1
  - pear install PHP_CodeSniffer && phpenv rehash
  - sudo pear channel-discover pear.survivethedeepend.com
  - sudo pear channel-discover hamcrest.googlecode.com/svn/pear
  - sudo pear install --alldeps deepend/Mockery
  - export PATH="$PATH:$CI_HOME:/usr/local/heroku/bin"
  - curl http://kort.rdmr.ch/webservices/update/git

script: ant -f build_kort.xml build

after_script:
  - bash $CI_HOME/server/heroku/heroku.sh
