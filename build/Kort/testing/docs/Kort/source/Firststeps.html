<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Kort-controller-Firststeps'>/**
</span> * Controller for firststeps overlay
 */
Ext.define('Kort.controller.Firststeps', {
    extend: 'Ext.app.Controller',

    config: {
<span id='Kort-controller-Firststeps-event-userchange'>        /**
</span>         * @event userchange
         * Fired when user gets changed
         */
        
        views: [
            'overlay.firststeps.Panel'
        ],
<span id='Kort-controller-Firststeps-cfg-refs'>        refs: {
</span>            firststepsPanel: '#firststepsPanel',
            usernameTextfield: '#firststepsPanel .textfield[name=username]',
            firststepsFormSubmitButton: '#firststepsFormSubmitButton'
        },
<span id='Kort-controller-Firststeps-cfg-control'>        control: {
</span>            firststepsFormSubmitButton: {
                tap: 'onFirststepsFormSubmitButtonTap'
            },
            usernameTextfield: {
                keyup: 'onUsernameTextfieldKeyUp'
            }
        }
    },

<span id='Kort-controller-Firststeps-method-onFirststepsFormSubmitButtonTap'>    onFirststepsFormSubmitButtonTap: function() {
</span>        var me = this,
            usernameValue = me.getUsernameTextfield().getValue(),
            messageBox;

        if(usernameValue !== '') {
            if(usernameValue.search(/^[a-zA-Z0-9]+$/) === -1) {
                messageBox = Ext.create('Kort.view.NotificationMessageBox');
                messageBox.alert(Ext.i18n.Bundle.message('firststeps.alert.username.specialchars.title'), Ext.i18n.Bundle.message('firststeps.alert.username.specialchars.message'), Ext.emptyFn);
            } else {
                me.getFirststepsFormSubmitButton().disable();
                Kort.user.set('username', usernameValue);
                Kort.user.save({
                    success: function() {
                        me.userSuccessfullSavedHandler();
                    },
                    failure: function() {
                        me.getFirststepsFormSubmitButton().enable();
                        messageBox = Ext.create('Kort.view.NotificationMessageBox');
                        messageBox.alert(Ext.i18n.Bundle.message('firststeps.alert.submit.failure.title'), Ext.i18n.Bundle.message('firststeps.alert.submit.failure.message'), Ext.emptyFn);
                    }
                }, me);
            }
        } else {
            messageBox = Ext.create('Kort.view.NotificationMessageBox');
            messageBox.alert(Ext.i18n.Bundle.message('firststeps.alert.username.empty.title'), Ext.i18n.Bundle.message('firststeps.alert.username.empty.message'), Ext.emptyFn);
        }
    },

<span id='Kort-controller-Firststeps-method-userSuccessfullSavedHandler'>    userSuccessfullSavedHandler: function(store, operation) {
</span>        this.getApplication().fireEvent('userchange');
        this.getFirststepsPanel().hide();
    },

<span id='Kort-controller-Firststeps-method-onUsernameTextfieldKeyUp'>    onUsernameTextfieldKeyUp: function(field, e) {
</span>        // submit form if return key was pressed
        if (e.event.keyCode === 13){
            this.onFirststepsFormSubmitButtonTap();
        }
    }
});</pre>
</body>
</html>
