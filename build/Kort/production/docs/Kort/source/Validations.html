<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Kort-store-Validations'>/**
</span> * Store for validations
 */
Ext.define('Kort.store.Validations', {
    extend: 'Ext.data.Store',
	
	config: {
<span id='Kort-store-Validations-cfg-model'>		model: 'Kort.model.Validation',
</span>        
<span id='Kort-store-Validations-cfg-grouper'>		grouper: {
</span>            groupFn: function(record) {
                var validationsLeft = record.get('required_validations') - record.get('upratings') + record.get('downratings');
                return validationsLeft + ' &lt;span class=&quot;text&quot;&gt;' + Ext.i18n.Bundle.message('validation.list.header') + '&lt;/span&gt;';
            }
        },
<span id='Kort-store-Validations-cfg-sorters'>        sorters: [
</span>            {
                // Sort by distance
                sorterFn: function(record1, record2) {
                    var distance1 = record1.get('distance'),
                        distance2 = record2.get('distance');
                    return distance1 &gt; distance2 ? 1 : (distance1 === distance2 ? 0 : -1);
                },
                direction: 'ASC'
            }
        ],
        
<span id='Kort-store-Validations-cfg-proxy'>		proxy: {
</span>			type: 'rest',
            url: './resources/stores/validations.json',
            pageParam: false,
            startParam: false,
            extraParams: {
                'limit': Kort.util.Config.getWebservices().validation.limit
            },
            reader: {
                type: 'json',
                rootProperty: 'return'
            }
		}
	},
    
<span id='Kort-store-Validations-method-updateDistances'>    /**
</span>     * Update distances of trails in store
     * @param {Kort.util.Geolocation} geo Geolocation to calculate distance
     */
	updateDistances: function(geo) {
        console.log('updatedistances');
		if(!this.isLoading()) {
			this.each(function(record, index, length) {
				record.set('distance', geo.getDistance(record.get('latitude'), record.get('longitude')));
				record.set('formatted_distance', geo.getFormattedDistance(record.get('distance')));
			});
			this.sort();
		}
	}
});
</pre>
</body>
</html>
