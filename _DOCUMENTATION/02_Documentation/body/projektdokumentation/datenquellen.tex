\chapter{Fehler-Datenquellen}
\label{datenquellen}

\todo[inline]{Fehlerdatenquellen überarbeiten}

Die Grundlage unserer \gls{WebApp} bilden die Fehlerdaten, welche korrigiert werden sollen.
Es galt deshalb zuerst eine geeignete Quelle für Fehlerdaten in \gls{OpenStreetMap} zu finden.

\section{Evaluation von geeigneten Datenquellen}
Durch die Anforderungen an die Applikation ergaben sich folgende Bedingungen, welche die Fehlerdaten erfüllen müssen:

\begin{itemize}
\item Die Fehler müssen auch für Nicht-\gls{Mapper} lösbar sein. Sprich die Beschreibungen sollten kein \glslink{Mapper}{Mapping}-Vokabular enthalten.
\item Sie müssen auf Deutsch übersetzbar sein. Die Fehlerbeschreibungen sollten somit einem gegebenen Schema folgen und nicht Freitext beinhalten.
\item Dadurch dass wir eine mobile App erstellen und keinen vollwertigen Karten-Editor, sollen die Fehler lediglich \glslink{Tag}{Tags} betreffen. Das Lösen des Fehlers sollte also möglich sein, ohne das Geometrieobjekt (Strasse, Gebäude, usw.) zu verändern.
\item Die Fehler sollten sich immer nur auf einen \gls{Tag} des betroffenen OSM-Objekt beziehen. Dadurch vereinfacht sich das Zurückschreiben der Daten zu \gls{OpenStreetMap}.
\end{itemize}

Wir untersuchten deshalb mehrere Fehlerdatenquellen auf deren Qualität.

\subsection{FIXME-Tags in OpenStreetMap}
Fehlerhafte Objekte in \gls{OpenStreetMap} können von Benutzern direkt mit einem \inlinecode{FIXME}-\gls{Tag} versehen werden, wenn sie einen Fehler aufweisen.
Darin wird der eigentliche Fehler beschrieben.

\begin{table}[H]
\centering
\begin{tabular}{|p{0.3\twocelltabwidth}|p{0.7\twocelltabwidth}|}
\hline 
\small{\textbf{URL}} & \url{http://wiki.openstreetmap.org/wiki/DE:Key:fixme} \\
\hline 
\small{\textbf{Erfasser}} & \gls{OpenStreetMap}-Benutzer \\
\hline 
\small{\textbf{API verfügbar?}} & Ja (\gls{REST} \gls{API}) \newline
\url{http://wiki.openstreetmap.org/wiki/API_v0.6} \\
\hline 
\small{\textbf{Lösung zurückschreiben}} & Lösung könnte via \gls{API} an \gls{OpenStreetMap} gesendet werden. \\
\hline
\small{\textbf{Eignung}} & \textbf{tief} \linebreak Durch die manuelle Erfassung der Daten, ist es für uns nicht möglich automatisiert ein GUI für die Fehlerbehebung zu erstellen. \\ 
\hline 
\end{tabular} 
\caption{FIXME-Tags in OpenStreetMap}
\label{datenquellen-fixme_tags_osm}
\end{table}

\subsection{OpenStreetBugs}
Mit der Applikation \emph{OpenStreetBugs} ist es für die Benutzer möglich Fehler in den Kartendaten als Bug zu erfassen.

\begin{table}[H]
\centering
\begin{tabular}{|p{0.3\twocelltabwidth}|p{0.7\twocelltabwidth}|}
\hline 
\small{\textbf{URL}} & \url{http://openstreetbugs.schokokeks.org/} \\
\hline 
\small{\textbf{Erfasser}} & OpenStreetBugs-Benutzer \\
\hline 
\small{\textbf{API verfügbar?}} & Ja (\gls{REST} \gls{API} oder Fehlerdaten als Dump-File downloadbar) \newline
\url{http://wiki.openstreetmap.org/wiki/OpenStreetBugs/API_0.6} \\
\hline 
\small{\textbf{Lösung zurückschreiben}} & Lösung müsste an \gls{OpenStreetMap} gesendet werden. Zusätzlich  müsste der Bug auf OpenStreetBugs als gelöst markiert werden. \\
\hline
\small{\textbf{Eignung}} & \textbf{tief} \linebreak Durch die manuelle Erfassung der Daten, ist es für uns nicht möglich automatisiert ein GUI für die Fehlerbehebung zu erstellen. \\ 
\hline 
\end{tabular} 
\caption{OpenStreetBugs}
\label{datenquellen-openstreetbugs}
\end{table}

\subsection{KeepRight}
\emph{KeepRight} ist ein Dienst, welcher jeweils über Nacht, Fehler in OSM-Objekten sucht und in einer eigenen Datenbank ablegt.

\begin{table}[H]
\centering
\begin{tabular}{|p{0.3\twocelltabwidth}|p{0.7\twocelltabwidth}|}
\hline 
\small{\textbf{URL}} & \url{http://keepright.ipax.at} \\
\hline 
\small{\textbf{Erfasser}} & Automatisiert durch nächtlichen Job \\
\hline 
\small{\textbf{API verfügbar?}} & Ja (Fehlerdaten werden als Dump-File zum Download angeboten) \newline \url{http://keepright.ipax.at/interfacing.php} \\
\hline 
\small{\textbf{Lösung zurückschreiben}} & Lösung müssten lediglich an \gls{OpenStreetMap} gesendet werden. \emph{KeepRight} baut seine Fehlerdatenbank jeweils über Nacht aus dem \gls{OpenStreetMap}-Daten neu auf. \\
\hline
\small{\textbf{Eignung}} & \textbf{hoch} \linebreak Dadurch das die Fehlerdaten automatisiert erstellt werden, ist es gut möglich, für jeweilige Fehlertypen eine geeignete Maske für deren Behebung zur Verfügung zu stellen. \\
\hline
\end{tabular}
\caption{KeepRight}
\label{datenquellen-keepright}
\end{table}

\section{Entscheid: Fehlerdaten von KeepRight}
Durch die gute Eignung der Fehlerdaten vom \emph{KeepRight}-Dienst, haben wir uns dazu entschieden deren Daten als Basis für unsere Fehler zu verwenden.

\section{Fehlerdaten in die Datenbank laden}
Um stets aktuelle Daten für die App anzuzeigen, wird der Dump von \emph{KeepRight} jede Nacht mit einem Shellskript in die Datenbank geladen.
Das Shellskript befindet sich unter:

\inlinecode{/server/database/keepright\_setup.sh}

Mittels Cronjob wird folgender Befehl aufgerufen:

\inlinecode{\$ setup\_keepright\_db.sh -o osm -n osm\_bugs -s keepright}

\begin{table}[H]
\centering
\begin{tabular}{|p{0.25\twocelltabwidth}|p{0.75\twocelltabwidth}|}
\hline 
\small{\textbf{Parameter}} & \small{\textbf{Bedeutung}} \\
\hline 
\inlinecode{-o osm} & Datenbankbenutzer welcher das Schema besitzen soll (\emph{Owner})  \\
\hline
\inlinecode{-n osm\_bugs} & Name der Datenbank  \\
\hline
\inlinecode{-s keepright} & Name des Schemas  \\
\hline
\end{tabular}
\caption{Parameter für setup\_keepright.sh}
\label{parameter-setup-keepright}
\end{table}

\subsection{Datenformat}
Auf der Webseite von \emph{KeepRight} ist ersichtlich\footnote{\url{http://www.keepright.at/interfacing.php}}, welche Daten im Dump enthalten sind.

\begin{table}[H]
\centering
\begin{tabular}{|p{0.25\twocelltabwidth}|p{0.75\twocelltabwidth}|}
\hline 
\small{\textbf{Feld}} & \small{\textbf{Bedeutung}} \\
\hline 
\inlinecode{schema} & Schemabezeichner welcher die Region gemäss Platet-Karte angibt  \\
\hline
\inlinecode{error\_id} & Fehler-ID pro Schema  \\
\hline
\inlinecode{error\_type} & Typisierung des Fehlers  \\
\hline
\inlinecode{error\_name} & Name des Fehlertyps  \\
\hline
\inlinecode{object\_type} & \gls{OpenStreetMap}-Typ des Objekts (\gls{Node}, \gls{Way} oder \gls{Relation})  \\ 
\hline
\inlinecode{object\_id} & \gls{OpenStreetMap}-ID des Objekts  \\
\hline
\inlinecode{state} & Status des Fehlers (new, reopened, ignore\_temporarily, ignore)  \\
\hline
\inlinecode{msgid} & Fehlermeldung mit Platzhaltern (\$1 - \$5)  \\
\hline
\inlinecode{txt1}\newline
\inlinecode{txt2}\newline
\inlinecode{txt3}\newline
\inlinecode{txt4}\newline
\inlinecode{txt5} & Texte für Platzhalter in msgid  \\
\hline
\inlinecode{first\_occurrence} & Zeitpunkt, an dem dieser Fehler das erste Mal entdeckt wurde (MESZ)  \\
\hline
\inlinecode{last\_checked} & Zeitpunkt an dem dieser Fehler das letzte Mal entdeckt wurde (MESZ)  \\
\hline
\inlinecode{object\_timestamp} & Letzter Änderungzeitpunkt am Objekt  \\
\hline
\inlinecode{user\_name} & Benutzer, welcher das Objekt zuletzt verändert hat  \\
\hline
\inlinecode{lat}\newline
\inlinecode{lon} & Längen- und Breitengrad des Fehlers  \\
\hline
\inlinecode{comment} & Kommentar zum Fehler  \\
\hline
\inlinecode{comment\_timestamp} & Zeitpunkt des Kommentars zum Fehler  \\
\hline
\end{tabular}
\caption{Datenformat der KeepRight-Daten}
\label{keepright-daten}
\end{table}

Diese Daten sind in der Tabelle \inlinecode{keepright.errors} enthalten.
Ein Subset davon wird für die Applikation benötigt.

\section{Internationalisierung der Texte aus der Datenbank}
\label{datenquellen-internationalisierung}
Eine Anforderung an \textsc{Kort} war es, ein deutsches UI anzubieten und daneben die App soweiter vorzubereits, dass sich diese Internationalisieren lässt.

Dies schliesst in diesem Fall die Texte aus der Datenbank mit ein.
Alle Fehlerdaten werden ohne Übersetzung aus der Datenbank gelesen und anschliessend mit den Werten aus den Datenbank-spezifischen Properties-Files.

Um die Texte zu ändern, können direkt die Dateien angepasst werden.